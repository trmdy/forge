# PR Review 2026-01-24: #1 and #2

## PR #1: feat(cli): enhance Codex integration in ralph.sh and harness.go
PR: https://github.com/tOgg1/forge/pull/1

### Findings (ordered by severity)
1) **Sandbox config not applied for default Codex profiles**
   - `applyCodexSandbox` bails out when `--dangerously-bypass-approvals-and-sandbox` is present, and the default Codex command template includes that flag. This means config-derived sandbox values never apply unless users override the command template.
   - Files: `internal/harness/harness.go:182-185`, `internal/harness/defaults.go:13`.

2) **Sandbox flag detection misses `--sandbox=<mode>`**
   - `applyCodexSandbox` only checks for `--sandbox ` (space form). If a command already includes `--sandbox=<mode>`, the function will still append a second `--sandbox`, resulting in duplicate/ambiguous flags.
   - File: `internal/harness/harness.go:182-195`.

3) **Ralph Codex detection fails for wrapper/env-prefixed commands**
   - `is_codex_cmd` only inspects the first token, so commands like `env CODEX_HOME=... codex exec -` or `command codex ...` won’t be recognized. This skips all Codex sandbox logic for common alias patterns.
   - File: `ralph.sh:112-116`, `ralph.sh:252-293`.

4) **New hard failure when CODEX_HOME cannot be found**
   - `start_loop` now exits if it can’t find a Codex home under `$HOME`, even if Codex runs fine without `CODEX_HOME` (e.g., PATH-only installs). This is a behavior change that could break existing flows.
   - File: `ralph.sh:258-262`.

### Merge recommendation
- **Do not merge yet**. The sandbox behavior in `internal/harness/harness.go` and the stricter Codex home detection in `ralph.sh` need clarification or fixes before merging.

## PR #2: feature/add basic skills
PR: https://github.com/tOgg1/forge/pull/2

### Findings (ordered by severity)
1) **`auth_home` ignored for skills install**
   - `resolveHarnessDest` always uses `baseDir` when it is non-empty. Since `skills bootstrap` passes the repo path as `baseDir`, installs go to repo-local paths (`.codex/skills`, `.claude/skills`, etc.) even when `auth_home` is configured. This contradicts `docs/skills.md` and README, and likely installs to the wrong location.
   - File: `internal/skills/skills.go:118-136`.

2) **Repo skills source vs embedded skills can drift**
   - `.agent-skills/` is committed alongside embedded `internal/skills/builtin/...`. CLI defaults to embedded skills, while the script defaults to `.agent-skills`. Without a sync mechanism, these sources can diverge.
   - Files: `.agent-skills/**`, `internal/skills/builtin/**`, `internal/cli/skills.go`.

3) **Installer script deletes destination content by default**
   - `scripts/install-skills.sh` uses `rsync -a --delete`, which will remove any user-added files under the destination skills directory. This is more destructive than the CLI installer (which skips unless `--force`). If intended, it should be clearly documented.
   - File: `scripts/install-skills.sh:170-177`.

### Merge recommendation
- **Hold merge** until the `auth_home` handling is corrected or the docs are updated to match the repo-local-only behavior.

## Communication
- None yet.
