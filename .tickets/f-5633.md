---
id: f-5633
status: closed
deps: [f-0fd1, f-c44a]
links: []
created: 2026-01-10T20:07:10Z
type: task
priority: 1
assignee: Tormod Haugland
parent: f-c2d0
---
# Implement fmail watch (standalone polling)

Implement `fmail watch` for standalone mode.

Required behavior (per docs/forge-mail/SPEC.md):
- Usage:
  - fmail watch            # all topics
  - fmail watch task       # topic only
  - fmail watch @myname    # DM inbox
- Options:
  - --timeout (default: forever)
  - -c/--count (exit after N messages)
  - --json

Implementation notes:
- Standalone mode must poll the filesystem every 100ms.
- Must not miss messages or duplicate messages.
- Exit code is 0 on normal exit (timeout/count/Ctrl+C).

## Acceptance Criteria

- Poll interval is 100ms in standalone mode
- `--count N` prints exactly N messages then exits 0
- `--timeout 5m` exits 0 after timeout if no messages arrive
- Supports watching all topics and a single topic
- Supports watching a DM inbox (dm/<agent>/)
- `--json` outputs machine-readable messages suitable for piping to jq


## Notes

**2026-01-11T07:10:02Z**

Implemented standalone watch with 100ms polling and JSON/plain output. go test ./... failed: permission denied on /root/.cache/go-build.
